
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
    <title>Import Handler file format</title>
  <!-- htmltitle is before nature.css - we use this hack to load bootstrap first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="_static/css/bootstrap.min.css" media="screen" />
  <link rel="stylesheet" href="_static/css/bootstrap-responsive.css"/>

    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="index.html" />
    <link rel="next" title="Feature JSON file format" href="features.html" />
    <link rel="prev" title="Command line utils" href="command_line_utils.html" />
  
   
       <script type="text/javascript" src="_static/sidebar.js"></script>
   
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="_static/js/bootstrap.min.js" type="text/javascript"></script>
  <link rel="canonical" href="http://scikit-learn.org/stable/import_handlers.html" />

  <script type="text/javascript">
    $("div.buttonNext, div.buttonPrevious").hover(
       function () {
           $(this).css('background-color', '#FF9C34');
       },
       function () {
           $(this).css('background-color', '#A7D6E2');
       }
    );
    var bodywrapper = $('.bodywrapper');
    var sidebarbutton = $('#sidebarbutton');
    sidebarbutton.css({'height': '900px'});
  </script>

  </head>
  <body>

<div class="header-wrapper">
    <div class="header"></div>
</div>



<div class="content-wrapper">
    <div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
        <div class="rel rellarge">
    

  <!-- rellinks[1:] is an ugly hack to avoid link to module
  index -->
        <div class="rellink">
        <a href="command_line_utils.html"
        accesskey="P">Previous
        <br/>
        <span class="smallrellink">
        Command line uti...
        </span>
            <span class="hiddenrellink">
            Command line utils
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="features.html"
        accesskey="N">Next
        <br/>
        <span class="smallrellink">
        Feature JSON fil...
        </span>
            <span class="hiddenrellink">
            Feature JSON file format
            </span>
        </a>
        </div>

    <!-- Ad a link to the 'up' page -->
    </div>
    

<!--
      <p class="doc-version">This documentation is for Cloudml <strong>version 2.0</strong> &mdash; <a href="http://scikit-learn.org/stable/support.html#documentation-resources">Other versions</a></p> -->
<!--     <p class="citing">If you use the software, please consider <a href="about.html#citing-scikit-learn">citing scikit-learn</a>.</p> -->
    <ul>
<li><a class="reference internal" href="#">Import Handler file format</a><ul>
<li><a class="reference internal" href="#top-level-element">Top level element</a></li>
<li><a class="reference internal" href="#script">Script</a></li>
<li><a class="reference internal" href="#inputs">Inputs</a></li>
<li><a class="reference internal" href="#datasources">Datasources</a><ul>
<li><a class="reference internal" href="#database-connections">Database connections</a></li>
<li><a class="reference internal" href="#csv-files">CSV files</a></li>
<li><a class="reference internal" href="#http">HTTP</a></li>
<li><a class="reference internal" href="#pig">Pig</a><ul>
<li><a class="reference internal" href="#pig-query">Pig query</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input">Input</a></li>
</ul>
</li>
<li><a class="reference internal" href="#import">Import</a><ul>
<li><a class="reference internal" href="#queries">Queries</a></li>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#python-scripts">Python Scripts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqoop">Sqoop</a></li>
<li><a class="reference internal" href="#nested-entities">Nested entities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#predict">Predict</a><ul>
<li><a class="reference internal" href="#model">Model</a><ul>
<li><a class="reference internal" href="#positive-label">positive_label</a></li>
<li><a class="reference internal" href="#weight">weight</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result">Result</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>



      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="import-handler-file-format">
<span id="import-handlers"></span><h1><a class="toc-backref" href="#id8">Import Handler file format</a><a class="headerlink" href="#import-handler-file-format" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#import-handler-file-format" id="id8">Import Handler file format</a><ul>
<li><a class="reference internal" href="#top-level-element" id="id9">Top level element</a></li>
<li><a class="reference internal" href="#script" id="id10">Script</a></li>
<li><a class="reference internal" href="#inputs" id="id11">Inputs</a></li>
<li><a class="reference internal" href="#datasources" id="id12">Datasources</a><ul>
<li><a class="reference internal" href="#database-connections" id="id13">Database connections</a></li>
<li><a class="reference internal" href="#csv-files" id="id14">CSV files</a></li>
<li><a class="reference internal" href="#http" id="id15">HTTP</a></li>
<li><a class="reference internal" href="#pig" id="id16">Pig</a></li>
<li><a class="reference internal" href="#input" id="id17">Input</a></li>
</ul>
</li>
<li><a class="reference internal" href="#import" id="id18">Import</a><ul>
<li><a class="reference internal" href="#queries" id="id19">Queries</a></li>
<li><a class="reference internal" href="#fields" id="id20">Fields</a></li>
<li><a class="reference internal" href="#sqoop" id="id21">Sqoop</a></li>
<li><a class="reference internal" href="#nested-entities" id="id22">Nested entities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#predict" id="id23">Predict</a><ul>
<li><a class="reference internal" href="#model" id="id24">Model</a></li>
<li><a class="reference internal" href="#result" id="id25">Result</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>There are two different approaches for importing data:</p>
<ul class="simple">
<li><strong>Import Handler</strong> is used for importing data from different datasources while training and testing the model. Now CSV files, HTTP with JSON or XML data, database and some others datasources are supported.</li>
<li><strong>Online Import Handler</strong> is used for importing data and feeding them to a trained classifier in order to get result.</li>
</ul>
<p>Both handlers may need to perform some transforming logic on their
import in order to produce the final results.</p>
<p>Although both handlers prepare data for the same classification model, their formats are a bit different.</p>
<div class="section" id="top-level-element">
<h2><a class="toc-backref" href="#id9">Top level element</a><a class="headerlink" href="#top-level-element" title="Permalink to this headline">¶</a></h2>
<p>Top level element is <cite>&lt;plan&gt;</cite>. There&#8217;s no attributes expected for this element. Plan may contain the following elements:</p>
<ul class="simple">
<li><a class="reference internal" href="#script"><em>script</em></a> (any)</li>
<li><a class="reference internal" href="#inputs"><em>inputs</em></a> (one or zero)</li>
<li><a class="reference internal" href="#datasources"><em>datasources</em></a> (exactly one)</li>
<li><a class="reference internal" href="#import"><em>import</em></a> (exactly one)</li>
<li><a class="reference internal" href="#predict"><em>predict</em></a> (should be present for Online Import Handler).</li>
</ul>
</div>
<div class="section" id="script">
<span id="id1"></span><h2><a class="toc-backref" href="#id10">Script</a><a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h2>
<p>A <cite>script</cite> element is used to define python functions that can be
used to transform data. Code inside the script tag will be added
whenever a python function is call. It is a good idea to wrap
scripts in &lt;![CDATA[ ...]]&gt; elements.</p>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;script&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        def intToBoolean(a):</span>
<span class="cp">            return a == 1</span>
<span class="cp">    ]]&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</div>
<p>It is also possible to reference external Python files. This can be
done to ease development. Scripts should be expected in the same
directory as the XML file.</p>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">&quot;functions.py&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Scripts from external python files functionality is not implemented yet.</p>
</div>
</div>
<div class="section" id="inputs">
<span id="id2"></span><h2><a class="toc-backref" href="#id11">Inputs</a><a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h2>
<p>Tag <cite>&lt;inputs&gt;</cite> groups all input parameters required to execute the import handler. Input parameters are defined in <cite>&lt;param&gt;</cite> tags.</p>
<p>Each param may have one of the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the name of the parameter.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>type</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{integer, boolean, string, float, date}, optional</span></dt>
<dd><p class="first last">the type of the input parameter. If ommited, it should be considered string.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>format</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">formating instructions for the parameter (i.e. date format etc).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>regex</cite> <span class="classifier-delimiter">:</span> <span class="classifier">regular expression string, optional</span></dt>
<dd><p class="first last">a regular expression that can be used to validate input parameter value</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Format could be applied only to the date input parameter using python&#8217;s <cite>strptime</cite> method. More details about format string could be found in
<a class="reference external" href="https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior">python documetation</a></p>
</div>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;inputs&gt;</span>
    <span class="c">&lt;!-- Define an integer parameter. Use regex to dictate only positive integers --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;application&quot;</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span> <span class="na">regex=</span><span class="s">&quot;\d+&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Date parameter with instructions on how to interpret date--&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;year&quot;</span> <span class="na">type=</span><span class="s">&quot;date&quot;</span> <span class="na">format=</span><span class="s">&quot;%Y&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Boolean parameter --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;only_fjp&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/inputs&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="datasources">
<span id="id3"></span><h2><a class="toc-backref" href="#id12">Datasources</a><a class="headerlink" href="#datasources" title="Permalink to this headline">¶</a></h2>
<p>Data is fed to the system using various datasources. The <cite>&lt;datasources&gt;</cite> part of the handler contains the connection details.</p>
<p>Datasources may be:</p>
<ul class="simple">
<li><a class="reference internal" href="#db-datasource"><em>Database connections</em></a></li>
<li><a class="reference internal" href="#csv-datasource"><em>CSV files</em></a></li>
<li><a class="reference internal" href="#http-datasource"><em>HTTP GET/POST</em></a></li>
<li><a class="reference internal" href="#pig-datasource"><em>Hadoop with Pig</em></a></li>
<li><a class="reference internal" href="#input-datasource"><em>Input params</em></a></li>
</ul>
<p>Datasources are identified by their unique names and can be accessed by
at any point in the file. Each datasource is using a different tag to
configure it.</p>
<div class="section" id="database-connections">
<span id="db-datasource"></span><h3><a class="toc-backref" href="#id13">Database connections</a><a class="headerlink" href="#database-connections" title="Permalink to this headline">¶</a></h3>
<p>Database connections can be defined either by directly inserting the
connection details or by referencing a named connection. In both cases,
the element used is <cite>&lt;db&gt;</cite>.</p>
<p>Here are the possible attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name for this datasource</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>name-ref</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">a reference to the named connection (not supported now)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>host</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the name of host to connect to</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>dbname</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">the database name</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>user</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">the username to use for connecting to the database</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>password</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">the password to use for connecting to the database</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>port</cite> <span class="classifier-delimiter">:</span> <span class="classifier">int, optional</span></dt>
<dd><p class="first last">the port number to connect to at the server host</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>vendor</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, {postgres}</span></dt>
<dd><p class="first last">the DB&#8217;s vendor. Only <cite>postgres</cite> vendor is supported now.</p>
</dd>
</dl>
</li>
</ul>
<p>Note that name is required in both cases. For named connections, only name-ref should be also present. When defining the DB connection details in handler&#8217;s file, host, dbname and vendor should be present.</p>
<p>Examples:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;db</span> <span class="na">name=</span><span class="s">&quot;odw&quot;</span> <span class="na">host=</span><span class="s">&quot;localhost&quot;</span> <span class="na">dbname=</span><span class="s">&quot;odw&quot;</span> <span class="na">user=</span><span class="s">&quot;postgres&quot;</span>
    <span class="na">password=</span><span class="s">&quot;postgres&quot;</span> <span class="na">vendor=</span><span class="s">&quot;postgres&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="csv-files">
<span id="csv-datasource"></span><h3><a class="toc-backref" href="#id14">CSV files</a><a class="headerlink" href="#csv-files" title="Permalink to this headline">¶</a></h3>
<p>CSV file can be used for importing data from local files. It is possible
to reuse headers from CSV file, or define aliases for the column names
in the import handler.</p>
<p>The related tag is <cite>csv</cite>, and the possible attributes are:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name for this datasource</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>src</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the path to the CSV file</p>
</dd>
</dl>
</li>
</ul>
<p>Header information can be defined by adding child <cite>&lt;header&gt;</cite> elements
to the <cite>&lt;csv&gt;</cite> element. Each <cite>&lt;header&gt;</cite> element must contain exactly
two fields:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the name of the column</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>index</cite> <span class="classifier-delimiter">:</span> <span class="classifier">integer</span></dt>
<dd><p class="first last">the column&#8217;s index (columns are zero-indexed).</p>
</dd>
</dl>
</li>
</ul>
<p>Examples:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- Defines a CSV datasource with headers in file. --&gt;</span>
<span class="nt">&lt;csv</span> <span class="na">name=</span><span class="s">&quot;csvDataSource1&quot;</span> <span class="na">src=</span><span class="s">&quot;stats.csv&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- Defines a CSV datasource with headers in handler. --&gt;</span>
<span class="nt">&lt;csv</span> <span class="na">name=</span><span class="s">&quot;csvDataSource2&quot;</span> <span class="na">src=</span><span class="s">&quot;stats.csv&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Note that some columns are ignored --&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">name=</span><span class="s">&quot;score&quot;</span> <span class="na">index=</span><span class="s">&quot;7&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/csv&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When importing data, if CSV file doesn&#8217;t contains column with index specified in &lt;header&gt; tag, user will get <cite>ImportHandlerException</cite>.
For example we will get this exception in <cite>csvDataSource2</cite> datasource (declared up in the document) if <cite>stats.csv</cite> file has six columns.</p>
</div>
</div>
<div class="section" id="http">
<span id="http-datasource"></span><h3><a class="toc-backref" href="#id15">HTTP</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h3>
<p>HTTP requests are used for importing JSON data from remote HTTP
services.</p>
<p>The tag used for defining them is <cite>&lt;http&gt;</cite>, and the possible attributes are:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name for this datasource</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>method</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{GET, POST, PUT, DELETE}, default=GET</span></dt>
<dd><p class="first last">the HTTP method to use</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>url</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the base URL to use</p>
</dd>
</dl>
</li>
</ul>
<p>When using this datasource with RESTful services, try to define the base
URL. If you need to query for specific entities, you can define query
parameters later during the import phase:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;plan&gt;</span>
    <span class="nt">&lt;inputs&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;opening_id&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/inputs&gt;</span>
    <span class="nt">&lt;datasources&gt;</span>
        <span class="nt">&lt;http</span> <span class="na">name=</span><span class="s">&quot;jar&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">url=</span><span class="s">&quot;http://service.com:11000/jar/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/datasources&gt;</span>
    <span class="nt">&lt;import&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">datasource=</span><span class="s">&quot;jar&quot;</span> <span class="na">name=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;query&gt;</span><span class="cp">&lt;![CDATA[#{opening_id}.json]]&gt;</span><span class="nt">&lt;/query&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">jsonpath=</span><span class="s">&quot;$.op_title&quot;</span> <span class="na">name=</span><span class="s">&quot;opening.title&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">jsonpath=</span><span class="s">&quot;$.op_job&quot;</span> <span class="na">name=</span><span class="s">&quot;opening.description&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
            ...
        <span class="nt">&lt;/entity&gt;</span>
    <span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/plan&gt;</span>
</pre></div>
</div>
<p>In this case, when importing data, system will query <a class="reference external" href="http://service.com:11000/jar/1.json">http://service.com:11000/jar/1.json</a> url (User sets user paramer <cite>opening_id</cite> as 1, when running importhandler.py command).</p>
</div>
<div class="section" id="pig">
<span id="pig-datasource"></span><h3><a class="toc-backref" href="#id16">Pig</a><a class="headerlink" href="#pig" title="Permalink to this headline">¶</a></h3>
<p>Pig is a tool for analyzing large data sets based on Hadoop. Pig Latin
is the language that allows querying and/or transforming the data. A Pig
datasource is a connection to a remote Hadoop/Pig cluster. It is defined
using <cite>&lt;pig&gt;</cite> tag. Possible attributes are:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name for this datasource</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>jobid</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">define job flow id, if you want to use existing cluster</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>amazon_access_token</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">by default use cloudml-control api keys</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>amazon_token_secret</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">by default use cloudml-control api keys</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>ami_version</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">Amazon Machine Image (AMI) version to use for instances.
<a class="reference external" href="http://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/Pig_SupportedVersions.html">Supported ami and pig versions</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>bucket_name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">Amazon S3 bucket name for saving results, logs, etc.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>ec2_keyname</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">EC2 key used for the start instances, by default use cloudml-control keypair</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>keep_alive</cite> <span class="classifier-delimiter">:</span> <span class="classifier">boolean, optional</span></dt>
<dd><p class="first last">Denotes whether the cluster should stay alive upon completion</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>hadoop_params</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">You can use this attribute to specify cluster-wide Hadoop settings. If it attribute isn&#8217;t setted, <em>s3://elasticmapreduce/bootstrap-actions/configure-hadoop</em> script would not be runned.
<a class="reference external" href="http://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/emr-plan-bootstrap.html">More details in Configure Hadoop Bootstrap Action block</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>num_instances</cite> <span class="classifier-delimiter">:</span> <span class="classifier">integer, optional</span></dt>
<dd><p class="first last">Number of instances in the Hadoop cluster</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>master_instance_type</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">EC2 instance type of the master node.
<a class="reference external" href="http://aws.amazon.com/ec2/instance-types/">List of Amazon EC2 Instance types</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>slave_instance_type</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">EC2 instance type of the slave nodes.</p>
</dd>
</dl>
</li>
</ul>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;pig</span> <span class="na">name=</span><span class="s">&quot;pig&quot;</span> <span class="na">amazon_access_token=</span><span class="s">&quot;token&quot;</span>         <span class="na">bucket_name=</span><span class="s">&quot;the_bucket&quot;</span> <span class="na">amazon_token_secret=</span><span class="s">&quot;secret&quot;</span> <span class="na">master_instance_type=</span><span class="s">&quot;c3.4xlarge&quot;</span> <span class="na">slave_instance_type=</span><span class="s">&quot;c3.4xlarge&quot;</span> <span class="na">num_instances=</span><span class="s">&quot;2&quot;</span> <span class="na">hadoop_params=</span><span class="s">&quot;-m,mapreduce.map.java.opts=-Xmx864m,-m,mapreduce.reduce.java.opts=-Xmx1536m,-m,mapreduce.map.memory.mb=1024,-m,mapreduce.reduce.memory.mb=2048,-y,yarn.nodemanager.resource.memory-mb=18226&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="section" id="pig-query">
<h4>Pig query<a class="headerlink" href="#pig-query" title="Permalink to this headline">¶</a></h4>
<p>Query tag of the entity with a pig datasource could have following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>target</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string optional</span></dt>
<dd><p class="first last">name of target dataset wich will be stored.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>autoload_sqoop_dataset</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">when it&#8217;s true, sqoop dataset will be auto loaded in the pig script (without defining loading statement in script). Require to define <cite>sqoop_dataset_name</cite> attr.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>sqoop_dataset_name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">variable name that would be used in the pig script for sqoop results, when <cite>autoload_sqoop_dataset</cite> setted.</p>
</dd>
</dl>
</li>
</ul>
<p>There are two ways for store pig results:</p>
<ul class="simple">
<li>You need to specify target attribute in the &lt;query&gt; tag of the entity with pig datasource. In this case results would be stored as JsonStorage:</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">query</span> <span class="n">target</span><span class="o">=</span><span class="ss">&quot;result&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span>
        <span class="p">...</span>
        <span class="k">result</span> <span class="o">=</span> <span class="n">FOREACH</span> <span class="n">B</span> <span class="n">GENERATE</span> <span class="n">application</span><span class="p">,</span> <span class="n">opening</span><span class="p">;</span>
    <span class="p">]]</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>we should use &#8216;$output&#8217; parameter as output dir. For example:</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="o">&lt;!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span>
        <span class="k">C</span> <span class="o">=</span> <span class="n">FOREACH</span> <span class="n">B</span> <span class="n">GENERATE</span> <span class="n">application</span><span class="p">,</span> <span class="n">opening</span><span class="p">;</span>
        <span class="n">STORE</span> <span class="k">C</span> <span class="k">INTO</span> <span class="s1">&#39;$output&#39;</span> <span class="k">USING</span> <span class="n">JsonStorage</span><span class="p">();</span>
    <span class="p">]]</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="input">
<span id="input-datasource"></span><h3><a class="toc-backref" href="#id17">Input</a><a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Input datasource using only in online import handlers.</p>
</div>
<p>If you need use Post data you should specify inpurt params
and after that you will have access to them using <tt class="docutils literal"><span class="pre">input</span></tt>
datasource with query <tt class="docutils literal"><span class="pre">any</span></tt>. For example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;plan&gt;</span>
    <span class="nt">&lt;inputs&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;rate&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/inputs&gt;</span>
    <span class="nt">&lt;datasources/&gt;</span>
    <span class="nt">&lt;import&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">datasource=</span><span class="s">&quot;input&quot;</span> <span class="na">name=</span><span class="s">&quot;Test_input&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;query&gt;</span>any<span class="nt">&lt;/query&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">column=</span><span class="s">&quot;title&quot;</span> <span class="na">name=</span><span class="s">&quot;dev_title&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">column=</span><span class="s">&quot;rate&quot;</span> <span class="na">name=</span><span class="s">&quot;rate&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/entity&gt;</span>
    <span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/plan&gt;</span>
</pre></div>
</div>
<p>Another one example with processing json input parameter:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;plan&gt;</span>
    <span class="nt">&lt;inputs&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;contractor_info&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/inputs&gt;</span>
    <span class="nt">&lt;datasources/&gt;</span>
    <span class="nt">&lt;import&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">datasource=</span><span class="s">&quot;input&quot;</span> <span class="na">name=</span><span class="s">&quot;contractor_info&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;query&gt;</span>contractor_info<span class="nt">&lt;/query&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_recno&quot;</span> <span class="na">name=</span><span class="s">&quot;contractor.id&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_region&quot;</span> <span class="na">name=</span><span class="s">&quot;contractor.region&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/entity&gt;</span>
    <span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/plan&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="import">
<span id="id4"></span><h2><a class="toc-backref" href="#id18">Import</a><a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h2>
<p>After defining the datasources, the import handler need to define how to
translate data from each datasource input. This is done within the
<cite>&lt;import&gt;</cite> element. In order to be able to understand how the mapping
is done, we need to introduce the concept of entity.</p>
<p>An entity models data coming from various datasources. I.e. an entity
might describe the data coming from a database table or view. Each
entity is associated with a datasource and (possibly) some query
parameters. For example, a database entity might use a SQL query, while
an HTTP entity might add some path and query parameters to the
datasource&#8217;s URL. An entity describes multiple entity &#8220;instances&#8221;. I.e.
if an entity describes a database table, an entity &#8220;instance&#8221; describes
a row in the database.</p>
<p>An entity is defined using the <cite>&lt;entity&gt;</cite> tag. The possible attributes
of the element are the following:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name to identify the entity</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>datasource</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">the datasource to use for importing data</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>query</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">a string that provides instructions on how to query a datasource (i.e. a SQL query or a path template). Queries can be also defined as child elements (to be discussed later).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>autoload_fields</cite> <span class="classifier-delimiter">:</span> <span class="classifier">boolean, optional</span></dt>
<dd><p class="first last">when setted we could not define fields. They would be loaded from the pig results.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><cite>autoload_fields</cite> works only with <cite>pig</cite> datasource for now.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <cite>autoload_fields</cite> setted, declared entity fields would be ovverrided with automaticaly created fields by parsing the result data row. If you declare the field, which isn&#8217;t present in the row,
it would not deleted.</p>
</div>
<p>Examples:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- An entity that uses a DB connection --&gt;</span>
<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;employer&quot;</span> <span class="na">datasource=</span><span class="s">&quot;mysqlConn&quot;</span> <span class="na">query=</span><span class="s">&quot;SELECT * FROM table&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/entity&gt;</span>

<span class="c">&lt;!-- An entity that uses an HTTP datasource --&gt;</span>
<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;employer&quot;</span> <span class="na">datasource=</span><span class="s">&quot;odr&quot;</span> <span class="na">query=</span><span class="s">&quot;opening/f/#{opening}.json&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<div class="section" id="queries">
<h3><a class="toc-backref" href="#id19">Queries</a><a class="headerlink" href="#queries" title="Permalink to this headline">¶</a></h3>
<p>The first possible child of a <cite>&lt;entity&gt;</cite> is a query. This can be used
to improve readability of the XML file and replace the query attribute
of the entity. It is also useful if the query doesn&#8217;t return data, but
actually triggers data calculation. Examples of such cases include
running a set of SQL queries that create tables or executing a Pig
script. In this case, attribute <cite>target</cite> needs to be defined inside
the <cite>&lt;query&gt;</cite> tag. The value of this attribute provides details on
where to look for the actual data.</p>
<p>Examples:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- An entity that uses a DB connection --&gt;</span>
<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;employer&quot;</span> <span class="na">datasource=</span><span class="s">&quot;mysqlConn&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            SELECT *</span>
<span class="cp">            FROM table t1 JOIN table t2 ON t1.id = t2.reference</span>
<span class="cp">            WHERE t2.creation_time &lt; &#39;#{start_date}&#39;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
    ...
<span class="nt">&lt;/entity&gt;</span>

<span class="c">&lt;!-- An entity that uses an HTTP datasource --&gt;</span>
<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;employer&quot;</span> <span class="na">datasource=</span><span class="s">&quot;json_ds&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;query&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            opening/f/#{opening}.json</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
    ...
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>Query strings depend on the datasource:</p>
<ul class="simple">
<li><a class="reference internal" href="#db-datasource"><em>Database connections</em></a>  requires SQL queries.</li>
<li><a class="reference internal" href="#csv-datasource"><em>CSV datasources</em></a> do not support queries.</li>
<li><a class="reference internal" href="#http-datasource"><em>HTTP datasources</em></a> can add values to end of the path.</li>
<li><a class="reference internal" href="#pig-datasource"><em>Hadoop with Pig datasource</em></a> - requires pig script.</li>
<li><a class="reference internal" href="#input-datasource"><em>Input params</em></a></li>
</ul>
<p>It is possible to use variables in queries using the notation <cite>#{variable}</cite>. This will be replaced either by an input parameter with name equal to the variable.</p>
</div>
<div class="section" id="fields">
<h3><a class="toc-backref" href="#id20">Fields</a><a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h3>
<p>Fields are used to define how to extract data from each entity
&#8220;instance&#8221;. They are defined using the <cite>&lt;field&gt;</cite> tag, and can define
the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a unique name for the field</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>column</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">if entity is using a DB or CSV datasource, it will use data from this column</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>jsonpath</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">if entity is a JSON datasource, or field type is json, it will use this jsonpath to extract data
<a class="reference external" href="http://goessner.net/articles/JsonPath/">More details about JsonPath strings</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>type</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{integer, boolean, string, float, json}, optional, default=string</span></dt>
<dd><p class="first last">If defined, the value will be converted to the given type. If it&#8217;s not possible, then the resulting value will be null.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>regex</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">applies the given regular expression and assigns the first match to the value</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>split</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">splits the value to an array of values using the provided regular expression</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>dateFormat</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">transforms value to a date using the given date/time format</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>join</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">concatenates values using the defined separator. Used together with <cite>jsonpath</cite> only.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>delimiter</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">concatenates values using the defined separator. Used together with <cite>jsonpath</cite> only.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>template</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">used to define a template for strings. May use variables.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>script</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">call the python script defined in this element and assign the result to this field. May use any of the built-in functions or any one defined in a <cite>Script</cite> element. Variables can also be used in script elements. Also could be defined as inner &lt;script&gt; tag.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>transform</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{&#8216;json&#8217;, &#8216;csv&#8217;}, optional</span></dt>
<dd><p class="first last">transforms this field to a datasource. For example, it can be used to parse JSON or CSV data stored in a DB column. Its values can be either <cite>json</cite> or <cite>csv</cite>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>headers</cite> <span class="classifier-delimiter">:</span> <span class="classifier">list, optional</span></dt>
<dd><p class="first last">used only if <cite>transform=&#8221;csv&#8221;</cite>. Defines the header names for each item in the CSV field. Not implemented now</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>required</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{&#8216;true&#8217;, &#8216;false&#8217;}, optional, default=false</span></dt>
<dd><p class="first last">whether this field is required to have a value or not.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>multipart</cite> <span class="classifier-delimiter">:</span> <span class="classifier">{&#8216;true&#8217;, &#8216;false&#8217;}, optional</span></dt>
<dd><p class="first last">if the results of <cite>jsonpath</cite> is complex/multipart value or simple value, Used only with <cite>jsonpath</cite></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>key_path</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">a JSON path expression for identifying the keys of a map. Used together with <cite>value_path</cite>
<a class="reference external" href="http://goessner.net/articles/JsonPath/">More details about JsonPath strings</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>value_path</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">a JSON path expression for identifying the values of a map. Used together with <cite>key_path</cite>.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can not use name for field &#8216;opening&#8217; if you want to have also fields as &#8216;opening.title&#8217;.</p>
</div>
<p>Examples:</p>
<p>HTTP JSON entities:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;jar_application&quot;</span> <span class="na">datasource=</span><span class="s">&quot;jar&quot;</span> <span class="na">query=</span><span class="s">&quot;get_s/#{employer}/#{application}.json&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;ja.bid_rate&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.hr_pay_rate&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;ja.bid_amount&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.fp_pay_amount&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.pref_count&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.job_pref_matches.prefs_match&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;application.creation_time&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.creation_time&quot;</span> <span class="na">dateFormat=</span><span class="s">&quot;YYYY-mm-DD&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/entity&gt;</span>

<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;contractor&quot;</span> <span class="na">datasource=</span><span class="s">&quot;jar&quot;</span> <span class="na">query=</span><span class="s">&quot;opening/f/#{opening}.json&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.skills&quot;</span> <span class="na">path=</span><span class="s">&quot;$.skills.*.skl_name&quot;</span> <span class="na">join=</span><span class="s">&quot;,&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.greeting&quot;</span> <span class="na">template=</span><span class="s">&quot;Hello #{contractor.name}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;matches_pref_english&quot;</span> <span class="na">script=</span><span class="s">&quot;#{contractor.dev_eng_skill}&gt; #{pref_english})&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>DB entity:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;dbentity&quot;</span> <span class="na">datasource=</span><span class="s">&quot;mysqlConnection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            SELECT *</span>
<span class="cp">            FROM table t1 JOIN table t2 ON t1.id = t2.reference</span>
<span class="cp">            WHERE t2.creation_time &lt; &#39;#{start_date}&#39;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.id&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.full_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;category&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.category&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.is_active&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.segment&quot;</span> <span class="na">script=</span><span class="s">&quot;getSegment(&#39;#{category}&#39;)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>DB entity where results should be read by table:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;dbentity&quot;</span> <span class="na">datasource=</span><span class="s">&quot;mysqlConnection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">target=</span><span class="s">&quot;data&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            CREATE TEMP TABLE data AS (</span>
<span class="cp">            SELECT *</span>
<span class="cp">            FROM table t1 JOIN table t2 ON t1.id = t2.reference</span>
<span class="cp">            WHERE t2.creation_time &lt; &#39;#{start_date}&#39;)</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.id&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.full_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;category&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.category&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.is_active&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.segment&quot;</span> <span class="na">script=</span><span class="s">&quot;getSegment(&#39;#{category}&#39;)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>Pig entity:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;dbentity&quot;</span> <span class="na">datasource=</span><span class="s">&quot;pigConnection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">target=</span><span class="s">&quot;output&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            batting = load &#39;Batting.csv&#39; using PigStorage(&#39;,&#39;);</span>
<span class="cp">            runs = FOREACH batting GENERATE $0 as playerID, $1 as year, $8 as runs;</span>
<span class="cp">            grp_data = GROUP runs by (year);</span>
<span class="cp">            STORE grp_data INTO &#39;output&#39;;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.id&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;t1.full_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;category&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.category&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span> <span class="na">column=</span><span class="s">&quot;t2.is_active&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.segment&quot;</span> <span class="na">script=</span><span class="s">&quot;getSegment(&#39;#{category}&#39;)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>Entity with field json datasource:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor_info&quot;</span> <span class="na">transform=</span><span class="s">&quot;json&quot;</span> <span class="na">column=</span><span class="s">&quot;contractor_info&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;contractor_info&quot;</span> <span class="na">datasource=</span><span class="s">&quot;contractor_info&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.dev_is_looking&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_is_looking&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.dev_is_looking_week&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_is_looking_week&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.dev_active_interviews&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_active_interviews&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor.dev_availability&quot;</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.dev_availability&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<div class="section" id="python-scripts">
<h4>Python Scripts<a class="headerlink" href="#python-scripts" title="Permalink to this headline">¶</a></h4>
<p>There are two variants to pass variables to the python script:</p>
<ul class="simple">
<li>using template formatting:</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;uniqueName&quot;</span> <span class="na">script=</span><span class="s">&quot;myFunction(#{id}, &#39;#{name}&#39;)&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>using variables:</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;uniqueName&quot;</span> <span class="na">script=</span><span class="s">&quot;myFunction(id, name)&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sqoop">
<span id="id6"></span><h3><a class="toc-backref" href="#id21">Sqoop</a><a class="headerlink" href="#sqoop" title="Permalink to this headline">¶</a></h3>
<p>Tag sqoop instructs import handler to run a Sqoop import. It should be
used only on entities that have a pig datasource. A sqoop tag may
contain the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>target</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, required</span></dt>
<dd><p class="first last">the target file to save imported data on HDFS.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>datasource</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, required</span></dt>
<dd><p class="first last">a reference to the DB datasource to use for importing the data</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>table</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, required</span></dt>
<dd><p class="first last">the name of the table to import its data.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>where</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">an expression that might be passed to the table for filtering the rows to import</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>direct</cite> <span class="classifier-delimiter">:</span> <span class="classifier">boolean, optional</span></dt>
<dd><p class="first last">whether to use direct import (see <a class="reference external" href="https://sqoop.apache.org/docs/1.4.4/SqoopUserGuide.html#_importing_views_in_direct_mode">Sqoop documentation</a> on &#8211;direct for more details)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>mappers</cite> <span class="classifier-delimiter">:</span> <span class="classifier">integer, optional</span></dt>
<dd><p class="first last">an integer number with the mappers to use for importing data. If table is a view or doesn&#8217;t have a key it should be 1. Default value is 1.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>options</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">Extra options for sqoop import command.</p>
</dd>
</dl>
</li>
</ul>
<p>If the sqoop tag contains body, then it should be valid SQL statements.
These statements will be executed on the database before the Sqoop
import. This feature is particularly useful if you want to run:</p>
<div class="highlight-xml"><pre>&lt;entity name="myEntity" datasource="pigConnection"&gt;
    &lt;query target="output"&gt;
    &lt;![CDATA[
        batting = load 'Batting.csv' using PigStorage(',');
        runs = FOREACH batting GENERATE $0 as playerID, $1 as year, $8 as runs;
        grp_data = GROUP runs by (year);
        STORE grp_data INTO 'output';
    ]]&gt;
    &lt;/query&gt;
    &lt;!-- Transfer table dataset to HDFS --&gt;
    &lt;sqoop target="dataset" table="dataset" datasource="sqoop_db_datasource" /&gt;

    &lt;!-- Query inside sqoop tag needs to be executed on the DB before running the sqoop command --&gt;
    &lt;!-- We should also allow multiple sqoop tags in case we require more than one imports --&gt;
    &lt;sqoop target="new_data" table="temp_table" datasource="sqoop_db_datasource" direct="true" mappers="1"&gt;
    &lt;![CDATA[
        CREATE TEMP TABLE target_openings AS SELECT * FROM openings WHERE creation_time BETWEEN #{start} AND #{end};
        CREATE TABLE temp_table AS SELECT to.*, e.* FROM target_openings to JOIN employer e ON to.employer=e."Record ID#";
    ]]&gt;
    &lt;/sqoop&gt;
    &lt;!-- Fields --&gt;
    &lt;field ... /&gt;
&lt;/entity&gt;</pre>
</div>
<p>For loading sqoop results in the pig script we should define:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;myEntity&quot;</span> <span class="na">datasource=</span><span class="s">&quot;pigConnection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sqoop</span> <span class="na">target=</span><span class="s">&quot;openings_dataset&quot;</span> <span class="na">table=</span><span class="s">&quot;temp_table&quot;</span> <span class="na">datasource=</span><span class="s">&quot;sqoop_db_datasource&quot;</span> <span class="na">direct=</span><span class="s">&quot;true&quot;</span> <span class="na">mappers=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">autoload_sqoop_dataset=</span><span class="s">&quot;true&quot;</span> <span class="na">sqoop_dataset_name=</span><span class="s">&quot;openings_dataset&quot;</span> <span class="na">target=</span><span class="s">&quot;result&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        register &#39;s3://odesk-match-staging/pig/lib/elephant-bird-core-4.4.jar&#39;;</span>
<span class="cp">        register &#39;s3://odesk-match-staging/pig/lib/elephant-bird-pig-4.4.jar&#39;;</span>
<span class="cp">        register &#39;s3://odesk-match-staging/pig/lib/elephant-bird-hadoop-compat-4.4.jar&#39;;</span>
<span class="cp">        register &#39;s3://odesk-match-staging/pig/lib/piggybank-0.12.0.jar&#39;;</span>

<span class="cp">        openings_dataset = LOAD &#39;$openings_dataset*&#39; USING org.apache.pig.piggybank.storage.CSVExcelStorage(&#39;,&#39;, &#39;YES_MULTILINE&#39;) AS (</span>
<span class="cp">            bidid:long</span>
<span class="cp">            , jobid:long</span>
<span class="cp">            , seller_userid:long</span>
<span class="cp">            , is_hired:chararray</span>
<span class="cp">            , seller_country:chararray</span>
<span class="cp">        );</span>

<span class="cp">        result = FOREACH openings_dataset GENERATE</span>
<span class="cp">            *</span>
<span class="cp">            , funcs.join((job_country, seller_country), &#39;,&#39;) as buyer_seller_countries</span>
<span class="cp">        ;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;query/&gt;</span>
<span class="nt">&lt;entity/&gt;</span>
</pre></div>
</div>
<p>Also we can auto load sqoop results, for example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;myEntity&quot;</span> <span class="na">datasource=</span><span class="s">&quot;pigConnection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sqoop</span> <span class="na">target=</span><span class="s">&quot;openings_dataset&quot;</span> <span class="na">table=</span><span class="s">&quot;temp_table&quot;</span> <span class="na">datasource=</span><span class="s">&quot;sqoop_db_datasource&quot;</span> <span class="na">direct=</span><span class="s">&quot;true&quot;</span> <span class="na">mappers=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">autoload_sqoop_dataset=</span><span class="s">&quot;true&quot;</span> <span class="na">sqoop_dataset_name=</span><span class="s">&quot;openings_dataset&quot;</span> <span class="na">target=</span><span class="s">&quot;result&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        result = FOREACH openings_dataset GENERATE</span>
<span class="cp">            *</span>
<span class="cp">            , funcs.join((job_country, seller_country), &#39;,&#39;) as buyer_seller_countries</span>
<span class="cp">        ;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;query/&gt;</span>
<span class="nt">&lt;entity/&gt;</span>
</pre></div>
</div>
<p>When <cite>autoload_sqoop_dataset</cite> setted CloudML will automatically add sqoop results definition on the top of the pig script. For example:</p>
<div class="highlight-txt"><pre>register 's3://odesk-match-staging/pig/lib/elephant-bird-core-4.4.jar';
register 's3://odesk-match-staging/pig/lib/elephant-bird-pig-4.4.jar';
register 's3://odesk-match-staging/pig/lib/elephant-bird-hadoop-compat-4.4.jar';
register 's3://odesk-match-staging/pig/lib/piggybank-0.12.0.jar';


result = LOAD '$dataset*' USING org.apache.pig.piggybank.storage.CSVExcelStorage(',', 'YES_MULTILINE') AS ( some_field:field_type );</pre>
</div>
</div>
<div class="section" id="nested-entities">
<h3><a class="toc-backref" href="#id22">Nested entities</a><a class="headerlink" href="#nested-entities" title="Permalink to this headline">¶</a></h3>
<p>It might be possible that not all data required might originate from one
entity, or it might be possible to gather data from more than one
datasources. For example, consider the following use case:</p>
<div class="highlight-python"><pre>A really important feature is application ranking.
In order to rank the application, data regarding the application,
the employer, the job opening and the contractor are required.
However, these data may come from different HTTP URLs.</pre>
</div>
<p>A solution to this problem is to use nested entities. A nested entity is a normal entity, with the benefit that it can use data from it&#8217;s parent entity to formulate the query. A nested entity may result in two ways:</p>
<ul class="simple">
<li>querying a &#8216;global&#8217; datasource (i.e. querying a different table in DB, calling a different HTTP service)</li>
<li>converting one of the parent entity&#8217;s field to a new entity (i.e. parsing the data of a DB column as a JSON document). In this case, the field acts as a datasource.</li>
</ul>
<p>A nested entity is defined inside another <cite>&lt;entity&gt;</cite> and follows exactly the same syntax. However, it might also use the values of parent entity as variables, in addition to the input parameter values.</p>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;application&quot;</span> <span class="na">datasource=</span><span class="s">&quot;ods&quot;</span> <span class="na">query=</span><span class="s">&quot;job_application/pa/#{application}.json&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.#{application}.opening_ref&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contractor&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.#{application}.developer_ref&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;employer&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.result.#{application}.team_ref&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Nested entity using a global datasource --&gt;</span>
    <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;opening&quot;</span> <span class="na">datasource=</span><span class="s">&quot;odr&quot;</span> <span class="na">query=</span><span class="s">&quot;opening/f/#{opening}.json&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.title&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.op_title&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;opening.description&quot;</span> <span class="na">jsonpath=</span><span class="s">&quot;$.op_job&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>The second option is to convert one of the parent entity&#8217;s fields to a
new entity. This is useful if a field in the parent entity contains CSV
or JSON data. To do this, two things need to be done:</p>
<ul class="simple">
<li>Define property &#8216;transform&#8217; in parent entity field, using the appropriate type. This creates a datasource accessible from all child entities. The datasource&#8217;s name is the field&#8217;s name, while the datasource type depends on the the value of the transform entity</li>
<li>In the new entity, define as datasource name the name of the parent entity&#8217;s field.</li>
</ul>
<p>Example:</p>
<div class="highlight-xml"><pre>&lt;!-- Parent entity --&gt;
&lt;entity name="user" datasource="dbEntity" query="SELECT * FROM users"&gt;
    &lt;!-- Convert field to CSV datasource --&gt;
    &lt;field name="permissions" transform="csv" headers="read,write,execute"/&gt;
    &lt;!-- Nested entity using data from CSV field --&gt;
    &lt;entity name="permissionEntity" datasource="permissions"&gt;
        &lt;field name="user.read" column="read" /&gt;
        &lt;field name="user.execute" column="execute" /&gt;
    &lt;/entity&gt;

    &lt;
    &lt;!-- Convert field to JSON datasource --&gt;
    &lt;field name="profile" transform="json" /&gt;

    &lt;!-- Nested entity using data from JSON field --&gt;
    &lt;entity name="profileEntity" datasource="profile"&gt;
        &lt;field name="score" jsonpath="$.score" /&gt;
    &lt;/entity&gt;
&lt;/entity&gt;</pre>
</div>
</div>
</div>
<div class="section" id="predict">
<span id="id7"></span><h2><a class="toc-backref" href="#id23">Predict</a><a class="headerlink" href="#predict" title="Permalink to this headline">¶</a></h2>
<p>The last part of the data import handler describes which models to
invoke and how to formulate the response. While the old import handler
was used with a single model, the new version should allow to use
multiple binary classifier models, provided that they expect the same
input vector.</p>
<p>Response format is defined inside <cite>&lt;predict&gt;</cite> tag. Predict tag needs
to have the following sub-elements:</p>
<ul class="simple">
<li><cite>&lt;model&gt;</cite> - defines parameters for using a model with the data from the <cite>&lt;import&gt;</cite> part of the handler</li>
<li><cite>&lt;result&gt;</cite> - defines how to formulate the response</li>
</ul>
<div class="section" id="model">
<h3><a class="toc-backref" href="#id24">Model</a><a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h3>
<p>In order to calculate the result of a prediction, one or more models
need to be invoked together with the data from the import handler. Each
model invocation is defined using a <cite>&lt;model&gt;</cite> tag. A model tag may
have the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>name</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, required</span></dt>
<dd><p class="first last">a name to uniquely identify the results of this model</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>value</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">holds the name of the model to use.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>script</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">calls python code to decide the name of the model to use.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Either value or script attribute need to be defined. Declaring none on both should raise an error.</p>
</div>
<p>In addition, you could define some additional child elements:</p>
<ul class="simple">
<li>positive_label</li>
<li>weight</li>
</ul>
<div class="section" id="positive-label">
<h4>positive_label<a class="headerlink" href="#positive-label" title="Permalink to this headline">¶</a></h4>
<p>Allows overriding which label to use as positive label. If not defined, true is considered as positive label. Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;model</span> <span class="na">name=</span><span class="s">&quot;rank&quot;</span> <span class="na">value=</span><span class="s">&quot;BestMatch.v31&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;positive_label</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/model&gt;</span>
</pre></div>
</div>
<p>A positive_label tag may have the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>value</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">holds the value of the model positive label</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>script</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">calls python code to decide the value of the model positive label</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="weight">
<h4>weight<a class="headerlink" href="#weight" title="Permalink to this headline">¶</a></h4>
<p>A positive_label tag may have the following attributes:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>value</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">holds the weight</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>script</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">calls python code to decide the weight</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>label</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">a label of data to apply the weight</p>
</dd>
</dl>
</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;model</span> <span class="na">name=</span><span class="s">&quot;recommend&quot;</span> <span class="na">value=</span><span class="s">&quot;my_model&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;weight</span> <span class="na">label=</span><span class="s">&quot;good_hire&quot;</span> <span class="na">script=</span><span class="s">&quot;3 if isHourly(&#39;#{opening.type_raw}&#39;) else 2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;weight</span> <span class="na">label=</span><span class="s">&quot;no_hire&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;weight</span> <span class="na">label=</span><span class="s">&quot;bad_hire&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/model&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It could be few <cite>&lt;model&gt;</cite> sub-elements in <cite>&lt;predict&gt;</cite> tag.</p>
</div>
</div>
</div>
<div class="section" id="result">
<h3><a class="toc-backref" href="#id25">Result</a><a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h3>
<p>Defines what to we need to render in results.</p>
<p>At may include two sub-elements:</p>
<ul class="simple">
<li><cite>label</cite></li>
<li><cite>probability</cite></li>
</ul>
<p>Label defines .... todo ... and contains following attributes:</p>
<ul class="simple">
<li><cite>model</cite> : string, optional</li>
<li><cite>script</cite> : string, optional</li>
</ul>
<p>Probability defines ... todo ... and contains following attributes:</p>
<ul>
<li><p class="first"><cite>label</cite> : string, optional</p>
</li>
<li><p class="first"><cite>model</cite> : string, optional</p>
</li>
<li><dl class="first docutils">
<dt><cite>script</cite> <span class="classifier-delimiter">:</span> <span class="classifier">string, optional</span></dt>
<dd><p class="first last">python script to ...</p>
</dd>
</dl>
</li>
</ul>
<p>Examples of <cite>result</cite> section:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;result&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">script=</span><span class="s">&quot;True if getPredictedLabel() == &#39;good_hire&#39; and getProbabilityFor(&#39;good_hire&#39;) &gt; 0.5 else False&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;probability</span> <span class="na">script=</span><span class="s">&quot;getProbabilityFor(&#39;good_hire&#39;)&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/result&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
        &copy; 2015, Upwork.
      <a href="_sources/import_handlers.txt" rel="nofollow">Show this page source</a>
    </div>
     <div class="rel rellarge">
    
    <div class="buttonPrevious">
      <a href="command_line_utils.html">Previous
      </a>
    </div>
    <div class="buttonNext">
      <a href="features.html">Next
      </a>
    </div>
    
     </div>

    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22606712-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> google.load('search', '1',
        {language : 'en'}); google.setOnLoadCallback(function() {
            var customSearchControl = new
            google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.setAutoComplete(true);
            customSearchControl.draw('cse', options); }, true);
    </script>
  </body>
</html>